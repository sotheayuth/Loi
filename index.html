<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CDC IPM – QIP Incentive Generator v3</title>

<style>
body{font-family:Arial;background:#F4F7FB;margin:0}
.wrap{max-width:1200px;margin:auto;padding:20px}
.card{background:white;padding:20px;border-radius:12px;margin-bottom:20px;box-shadow:0 4px 15px rgba(0,0,0,.08)}
input,select{width:100%;padding:10px;margin-bottom:12px;border-radius:8px;border:1px solid #ccc}
button{padding:12px 16px;background:#0B2E5A;color:white;border:none;border-radius:8px;font-weight:bold;cursor:pointer}
table{width:100%;border-collapse:collapse;margin-top:20px}
th,td{border:1px solid #ddd;padding:10px;vertical-align:top;white-space:pre-line}
th{background:#0B2E5A;color:white}
.banner{margin-bottom:10px}
.ok{color:green}
.warn{color:#B45309}
.bad{color:#B91C1C}
h2{margin-top:0}
</style>
</head>

<body>
<div class="wrap">

<div class="card">
<h2>CDC IPM – Executive Incentive Generator</h2>

<label>Investment Activity</label>
<input id="search" placeholder="Search activity...">
<select id="activity"></select>

<label>QIP Status</label>
<select id="qip">
<option value="TaxHoliday">Tax Holiday</option>
<option value="SpecialDep">Special Depreciation</option>
<option value="AfterOrNonQIP">After QIP | Non-QIP</option>
</select>

<label>Product Market</label>
<select id="market">
<option value="Export">Export</option>
<option value="Domestic">Domestic</option>
<option value="Supporting">Supporting</option>
</select>

<label>Ind’ Audit</label>
<select id="audit">
<option value="No">No</option>
<option value="Yes">Yes</option>
</select>

<label>Investment Capital (USD)</label>
<input id="capital" placeholder="Example: 2000000">

<label>Annual Turnover (Riel)</label>
<input id="turnover" placeholder="Example: 4000000000">

<button onclick="generate()">Generate Incentive</button>
<div class="banner" id="banner"></div>
</div>

<div class="card" id="result" style="display:none">
<h3>Incentive Matrix</h3>
<table>
<tr><th>Category</th><th>Incentive</th></tr>
<tr><td>Corporate Tax</td><td id="corp"></td></tr>
<tr><td>Import Duty</td><td id="imp"></td></tr>
<tr><td>Export Duty</td><td id="exp"></td></tr>
</table>
</div>

</div>

<script>

/* ===== DATASET (sample structure) ===== */
/* Replace this sample with your full Annex 492 dataset */

const ACTIVITIES = [
  {annex:"1", id:"A1-A.1", title:"Example Annex 1 Activity", criteria:"Not eligible", isic:""},
  {annex:"2", id:"A2-G1-I1", title:"Data Center Development", criteria:"", isic:"6311"},
  {annex:"2", id:"A2-G2-I5", title:"Agro Processing Plant", criteria:"", isic:"1030"},
  {annex:"3", id:"A3-1", title:"Dry Port", criteria:"Minimum capital USD 2,000,000", isic:""},
  {annex:"4", id:"A4-19", title:"Manufacture of Boilers", criteria:"", isic:"2513"}
];

/* ===== UI Load ===== */

const actSelect = document.getElementById("activity");
const search = document.getElementById("search");

function loadOptions(list){
  actSelect.innerHTML="";
  list.forEach(a=>{
    let opt=document.createElement("option");
    opt.value=a.id;
    opt.text=a.id+" - "+a.title;
    actSelect.appendChild(opt);
  });
}

loadOptions(ACTIVITIES);

search.addEventListener("input", ()=>{
  let q=search.value.toLowerCase();
  let filtered=ACTIVITIES.filter(a=>a.title.toLowerCase().includes(q));
  loadOptions(filtered);
});

/* ===== Logic ===== */

function extractCapitalThreshold(criteria){
  let m=criteria.match(/USD\s?([0-9,]+)/i);
  if(m) return parseFloat(m[1].replace(/,/g,""));
  return null;
}

function generate(){
  let id=actSelect.value;
  let selected=ACTIVITIES.find(a=>a.id===id);

  let annex=selected.annex;
  let capital=parseFloat(document.getElementById("capital").value)||0;
  let turnover=parseFloat(document.getElementById("turnover").value)||0;
  let qip=document.getElementById("qip").value;
  let market=document.getElementById("market").value;

  let banner=document.getElementById("banner");
  banner.innerHTML="";

  let corp="", imp="", exp="";

  /* Annex 1 */
  if(annex==="1"){
    banner.innerHTML="<div class='bad'>Activity listed in Annex 1 (Not Eligible).</div>";
    corp="Not Eligible";
    imp="Not Eligible";
    exp="Not Eligible";
  }

  /* Annex 2 */
  else if(annex==="2"){
    if(selected.id.includes("G1")) corp="Tax Holiday – 9 Years";
    else if(selected.id.includes("G2")) corp="Tax Holiday – 6 Years";
    else if(selected.id.includes("G3")) corp="Tax Holiday – 3 Years";

    imp="Exempt (QIP import rules)";
    exp=(market==="Export")?"0% Export Duty":"Normal Rules";
  }

  /* Annex 3 */
  else if(annex==="3"){
    let threshold=extractCapitalThreshold(selected.criteria);
    if(threshold && capital<threshold){
      banner.innerHTML="<div class='warn'>Capital below Annex 3 minimum threshold.</div>";
    }
    corp="Not Eligible for Tax Holiday (Annex 3)";
    imp="Customs/VAT Exemption (Annex 3)";
    exp=(market==="Export")?"0% Export Duty":"Normal Rules";
  }

  /* Annex 4 */
  else if(annex==="4"){
    corp=(qip==="TaxHoliday")?"0% During Holiday":"Normal CIT Rules";
    if(market==="Domestic")
      imp="Production Input Incentive Eligible (Annex 4)";
    else
      imp="Normal Rules";
    exp=(market==="Export")?"0% Export Duty":"Normal Rules";
  }

  if(turnover>4000000000)
    corp+="\nPatent: R 3m";

  document.getElementById("corp").innerText=corp;
  document.getElementById("imp").innerText=imp;
  document.getElementById("exp").innerText=exp;

  document.getElementById("result").style.display="block";
}

</script>
</body>
</html>